#!/bin/bash

LOG_PATH=~/.time-mg-opc.csv  # TIME MG TIME TRACKER

if [ -e ~/opencal.lock ]
then
    zenity --error --title="Error" --text="OPC already run (~/opencal.lock)"
else
    touch ~/opencal.lock

    echo "opc-start,$(date --iso-8601='seconds')" >> ${LOG_PATH}  # TIME MG TIME TRACKER

    OPC=$(python -c "import opcgui.qt.main ; print(opcgui.qt.main.__file__)")

    # TODO: WORKAROUND https://forum.qt.io/topic/54802/linux-application-does-not-accept-keyboard-input/4
    QT_XKB_CONFIG_ROOT=/usr/share/X11/xkb $OPC

    #./opcgui/qt/main.py

    echo "opc-stop,$(date --iso-8601='seconds')" >> ${LOG_PATH}  # TIME MG TIME TRACKER

    rm ~/opencal.lock
fi
